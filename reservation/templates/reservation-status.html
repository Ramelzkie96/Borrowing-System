{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<!-- CSS -->
<link rel="stylesheet" type="text/css" href="{%static 'vendorss/styles/core.css'%}">
<link rel="stylesheet" type="text/css" href="{%static 'vendorss/styles/icon-font.min.css'%}">
<link rel="stylesheet" type="text/css" href="{%static 'vendorss/styles/style.css'%}">
<link rel="stylesheet" href="{% static 'vendor/pickadate/themes/default.css' %}">
<link rel="stylesheet" href="{% static 'vendor/pickadate/themes/default.date.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

<style>
    /* Hide the alert after the transition */
    .hide-alert {
        opacity: 0;
        transition: opacity 0.6s ease-out;
        /* Smooth transition */
    }

    /* Optional: smooth fade-in for when the alert first appears */
    .alert-fade {
        opacity: 1;
        transition: opacity 0.6s ease-in;
        /* Smooth transition */
    }

    /* Adjust the size of the card container */
    .custom-card {
        height: 330px !important;
        /* Increase height */
        width: 1000px;
        /* Increase width */
    }

    /* Optionally adjust the card styling */
    .card-box {
        height: 100%;
        /* Ensure the card-box fills its container */
        width: 100%;
        /* Ensure the card-box fills its container */
        padding: 20px;
        /* Add padding if needed */
    }

    /* Style adjustments for elements inside the card */
    .card-box .reserve-img {
        width: 60px;
        /* Increase the icon size */
    }

    .card-box .h4 {
        font-size: 36px;
        /* Adjust font size for better visibility */
    }

    .card-box .font-14 {
        font-size: 18px;
        /* Adjust font size for better readability */
    }

    .card-box .btn {
        width: 180px;
        /* Increase button width */
        height: 40px;
        /* Increase button height */
        font-size: 14px;
        /* Increase button font size */
    }

    input[type="radio"] {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        outline: none;
        background-color: transparent;
        border: 2px solid #bebebe;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        position: relative;
    }

    /* Style the radio button when it is checked */
    input[type="radio"]:checked::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 12px;
        height: 12px;
        background-color: #007bff;
        /* Color of the checked state */
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    /* Style the label to align with the custom radio button */
    label {
        display: flex;
        align-items: center;
        margin-bottom: 0;
        cursor: pointer;
    }

    /* Optional: Style the label when the radio button is focused */
    input[type="radio"]:focus+label {
        outline: 1px solid #007bff;
        /* Focus outline color */
    }
    .notification-close {
        background: none;
        border: none;
        color: #999; /* Adjust color as needed */
        font-size: 16px; /* Adjust size as needed */
        cursor: pointer;
        position: absolute;
        top: 10px; /* Adjust as needed */
        right: 10px; /* Adjust as needed */
    }
    
    .notification-close:hover {
        color: #f00; /* Change color on hover */
    }
    
    .notification-list {
        position: relative;
    }
    
    .notification-content {
        padding-right: 30px; /* Space for the close icon */
    }
</style>

{% endblock %}


{% block extra_js %}
<script src="{%static 'vendorss/scripts/core.js'%}"></script>
<script src="{%static 'vendorss/scripts/script.min.js'%}"></script>
<script src="{%static 'vendorss/scripts/process.js'%}"></script>
<script src="{%static 'vendorss/scripts/layout-settings.js'%}"></script>
<script src="{%static 'vendorss/scripts/dashboard.js'%}"></script>
<!-- pickadate -->
<script src="{% static 'vendor/pickadate/picker.js' %}"></script>
<script src="{% static 'vendor/pickadate/picker.time.js' %}"></script>
<script src="{% static 'vendor/pickadate/picker.date.js' %}"></script>
<script src="{% static 'js/plugins-init/pickadate-init.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

{% endblock %}



{% block content %}
<div class="header">
    <div class="header-left">
        <div class="menu-icon dw dw-menu"></div>
        <div class="header-search">
            <form>
                <div class="form-group mb-0">

                    <div class="dropdown">

                        <div class="dropdown-menu dropdown-menu-right">
                            <div class="form-group row">
                                <label class="col-sm-12 col-md-2 col-form-label">From</label>
                                <div class="col-sm-12 col-md-10">
                                    <input class="form-control form-control-sm form-control-line" type="text">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-12 col-md-2 col-form-label">To</label>
                                <div class="col-sm-12 col-md-10">
                                    <input class="form-control form-control-sm form-control-line" type="text">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-12 col-md-2 col-form-label">Subject</label>
                                <div class="col-sm-12 col-md-10">
                                    <input class="form-control form-control-sm form-control-line" type="text">
                                </div>
                            </div>
                            <div class="text-right">
                                <button class="btn btn-primary">Search</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="header-right">
        <div class="dashboard-setting user-notification">
            <div class="dropdown">
                <a class="dropdown-toggle no-arrow" href="javascript:;" data-toggle="right-sidebar">
                    <i class="dw dw-settings2"></i>
                </a>
            </div>
        </div>
        <div class="user-notification">
            <div class="dropdown">
                <a class="dropdown-toggle no-arrow" href="#" role="button" data-toggle="dropdown" id="notification-icon">
                    <i class="icon-copy dw dw-notification"></i>
                    {% if unread_notification > 0 %}
                        <span class="notification-active text-danger" style="font-size: 15px; font-weight: 800; position: absolute;">
                            {{ unread_notification }}
                        </span>
                    {% endif %}
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                    <div class="notification-list mx-h-350 customscroll">
                        <ul id="notification-list">
                            {% if reservations %}
                                {% for reservation in reservations %}
                                    <li data-id="{{ reservation.id }}" class="{% if reservation.is_read %} read {% endif %}">
                                        <a href="#">
                                            <img src="{{ reservation.handled_by_profile_picture }}" alt="Handled by {{ reservation.handled_by }}">
                                            <div class="notification-content">
                                                <h3>{{ reservation.handled_by }}</h3>
                                                <p>{{ reservation.notification }}</p>
                                            </div>
                                            <button class="notification-close" data-id="{{ reservation.id }}">
                                                <i class="icon-copy dw dw-delete-3"></i>
                                            </button>
                                        </a>
                                    </li>
                                {% endfor %}
                            {% else %}
                                <li class="no-notifications text-center">
                                    <p>No available notifications</p>
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="user-info-dropdown">
            <div class="dropdown">
                <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                    <span class="user-icon" style="display: inline-block; width: 50px; height: 50px; overflow: hidden; border-radius: 50%;">
                        <img src="{{ user.profile_image.url }}" alt="Profile Image" style="width: 100%; height: 100%; object-fit: cover;">
                    </span>
                    
                    <span class="user-name">{{ user.name }}</span>
                </a>
                <div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
                    <a class="dropdown-item" href="profile.html"><i class="dw dw-user1"></i> Profile</a>
                    <a class="dropdown-item" href="profile.html"><i class="dw dw-settings2"></i> Setting</a>
                    <a class="dropdown-item" href="faq.html"><i class="dw dw-help"></i> Help</a>
                    <a class="dropdown-item" href="{% url 'reservation-logout' %}"><i class="dw dw-logout"></i> Log
                        Out</a>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="right-sidebar">
    <div class="sidebar-title">
        <h3 class="weight-600 font-16 text-blue">
            Layout Settings
            <span class="btn-block font-weight-400 font-12">User Interface Settings</span>
        </h3>
        <div class="close-sidebar" data-toggle="right-sidebar-close">
            <i class="icon-copy ion-close-round"></i>
        </div>
    </div>
    <div class="right-sidebar-body customscroll">
        <div class="right-sidebar-body-content">
            <h4 class="weight-600 font-18 pb-10">Header Background</h4>
            <div class="sidebar-btn-group pb-30 mb-10">
                <a href="javascript:void(0);" class="btn btn-outline-primary header-white active">White</a>
                <a href="javascript:void(0);" class="btn btn-outline-primary header-dark">Dark</a>
            </div>

            <h4 class="weight-600 font-18 pb-10">Sidebar Background</h4>
            <div class="sidebar-btn-group pb-30 mb-10">
                <a href="javascript:void(0);" class="btn btn-outline-primary sidebar-light ">White</a>
                <a href="javascript:void(0);" class="btn btn-outline-primary sidebar-dark active">Dark</a>
            </div>

            <h4 class="weight-600 font-18 pb-10">Menu Dropdown Icon</h4>
            <div class="sidebar-radio-group pb-10 mb-10">
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="sidebaricon-1" name="menu-dropdown-icon" class="custom-control-input"
                        value="icon-style-1" checked="">
                    <label class="custom-control-label" for="sidebaricon-1"><i class="fa fa-angle-down"></i></label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="sidebaricon-2" name="menu-dropdown-icon" class="custom-control-input"
                        value="icon-style-2">
                    <label class="custom-control-label" for="sidebaricon-2"><i class="ion-plus-round"></i></label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="sidebaricon-3" name="menu-dropdown-icon" class="custom-control-input"
                        value="icon-style-3">
                    <label class="custom-control-label" for="sidebaricon-3"><i
                            class="fa fa-angle-double-right"></i></label>
                </div>
            </div>

            <h4 class="weight-600 font-18 pb-10">Menu List Icon</h4>
            <div class="sidebar-radio-group pb-30 mb-10">
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="sidebariconlist-1" name="menu-list-icon" class="custom-control-input"
                        value="icon-list-style-1" checked="">
                    <label class="custom-control-label" for="sidebariconlist-1"><i class="ion-minus-round"></i></label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="sidebariconlist-2" name="menu-list-icon" class="custom-control-input"
                        value="icon-list-style-2">
                    <label class="custom-control-label" for="sidebariconlist-2"><i class="fa fa-circle-o"
                            aria-hidden="true"></i></label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="sidebariconlist-3" name="menu-list-icon" class="custom-control-input"
                        value="icon-list-style-3">
                    <label class="custom-control-label" for="sidebariconlist-3"><i class="dw dw-check"></i></label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="sidebariconlist-4" name="menu-list-icon" class="custom-control-input"
                        value="icon-list-style-4" checked="">
                    <label class="custom-control-label" for="sidebariconlist-4"><i
                            class="icon-copy dw dw-next-2"></i></label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="sidebariconlist-5" name="menu-list-icon" class="custom-control-input"
                        value="icon-list-style-5">
                    <label class="custom-control-label" for="sidebariconlist-5"><i
                            class="dw dw-fast-forward-1"></i></label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="sidebariconlist-6" name="menu-list-icon" class="custom-control-input"
                        value="icon-list-style-6">
                    <label class="custom-control-label" for="sidebariconlist-6"><i class="dw dw-next"></i></label>
                </div>
            </div>

            <div class="reset-options pt-30 text-center">
                <button class="btn btn-danger" id="reset-settings">Reset Settings</button>
            </div>
        </div>
    </div>
</div>

<div class="left-side-bar">
    <div class="brand-logo">
        <a href="{% url 'reservation-dashboard' %}">
            <img src="{%static 'images/pit_logo.png'%}" alt="" width="50" height="50">
            <span class="text-white" style="font-weight: 800; font-size: 14px;">&nbsp; Student Reservation</span>
        </a>
        <div class="close-sidebar" data-toggle="left-sidebar-close">
            <i class="ion-close-round"></i>
        </div>
    </div>
    <div class="menu-block customscroll">
        <div class="sidebar-menu">
            <ul id="accordion-menu">
                <li>
                    <a href="{% url 'reservation-dashboard' %}" class="dropdown-toggle no-arrow">
                        <span class="micon fa-solid fa-gauge" style="font-size: 25px;"></span><span class="mtext">Home</span>
                    </a>
                </li>
                
                
                <li>
                    <a href="javascript:void()" class="dropdown-toggle no-arrow">
                        <span class="micon fa-solid fa-spinner"></span><span class="mtext">Status</span>
                    </a>
                </li>
                
                <li>
                    <div class="dropdown-divider"></div>
                </li>
                
                <li class="dropdown">
                    <a href="javascript:;" class="dropdown-toggle">
                        <img src="{% static 'images/manage-account.png' %}" width="20" height="20" class="micon" alt=""><span class="mtext"> Manage Account </span>
                    </a>
                    <ul class="submenu">
                        <li><a href="{% url 'reservation-change-profile' %}">Edit Profile</a></li>
                        <li><a href="{% url 'reservation-change-password' %}">Change Password</a></li>
                    </ul>
                </li>
                <li>
                    <a href="{% url 'reservation-logout' %}" class="dropdown-toggle no-arrow">
                        <span class="micon fa-solid fa-right-from-bracket"></span><span class="mtext">Logout</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="mobile-menu-overlay"></div>




<div class="main-container">
    <!-- Dynamic messages start -->
    <div id="django-messages" style="display:none;">
        {% for message in messages %}
            <div class="message" data-type="{{ message.tags }}" data-content="{{ message|escapejs }}"></div>
        {% endfor %}
    </div>
    <!-- Dynamic messages end -->
    <div class="pd-ltr-20">


        <!-- Bordered table  start -->
        <div class="pd-20 card-box mb-30 mt-5">
            <div class="clearfix mb-20">
                <div class="pull-left">
                    <h4 class="text-blue h4" style="font-size: 25px;">Item Reservation Status</h4>
                    <label>Show entries &nbsp;
                        <select name="example_length" aria-controls="example" class="form-control" onchange="updateShowEntries(this.value)" style="width: 100px;">
                            <option value="all" {% if current_show == 'all' %}selected{% endif %}>All</option>
                            <option value="5" {% if current_show == 5 %}selected{% endif %}>5</option>
                            <option value="10" {% if current_show == 10 %}selected{% endif %}>10</option>
                            <option value="25" {% if current_show == 25 %}selected{% endif %}>25</option>
                            <option value="50" {% if current_show == 50 %}selected{% endif %}>50</option>
                            <option value="100" {% if current_show == 100 %}selected{% endif %}>100</option>
                        </select>
                    </label>
                </div>
                <div class="pull-right" style="position: relative;">
                    <i class="fa-solid fa-magnifying-glass" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%);"></i>
                    <input type="text" placeholder="Search..." style="padding-left: 30px; width: 100%; height: 40px; border: 1px solid #ccc; border-radius: 5px;" id="searchInput" onkeyup="searchTable()">
                </div>
            </div>
            <table class="table table-bordered table-striped" id="itemTable">
                <thead style="background-color: #031e23; color: white;">
                    <tr>
                        <th scope="col">STUDENT ID</th>
                        <th scope="col">NAME</th>
                        <th scope="col">COURSE</th>
                        <th scope="col">YEAR</th>
                        <th scope="col">ITEM</th>
                        <th scope="col">QUANTITY</th>
                        <th scope="col">DATE RESERVE</th>
                        <th scope="col">STATUS</th>
                        <th scope="col">ACTION</th>
                    </tr>
                </thead>
                <tbody>
                    {% if student_reservations %}
                        {% for reservation in student_reservations %}
                            <tr>
                                <td>{{ reservation.student_id }}</td>
                                <td>{{ reservation.name }}</td>
                                <td>{{ reservation.course }}</td>
                                <td>{{ reservation.year_level }}</td>
                                <td>{{ reservation.content_object.name }}</td> <!-- Assuming content_object refers to the item -->
                                <td>{{ reservation.quantity }}</td>
                                <td>{{ reservation.reserve_date }}</td>
                                <td>
                                    {% if reservation.status == "Approved" %}
                                        <div class="badge badge-success">{{ reservation.status }}</div>
                                    {% elif reservation.status == "Pending" %}
                                        <div class="badge badge-secondary">{{ reservation.status }}</div>
                                    {% else %}
                                        <div class="badge badge-danger">{{ reservation.status }}</div>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="dropdown-item view-item-btn" data-toggle="modal" data-target="#exampleModalCenter"
                                    data-student-id="{{ reservation.student_id }}"
                                    data-name="{{ reservation.name }}"
                                    data-course="{{ reservation.course }}"
                                    data-year="{{ reservation.year_level }}"
                                    data-email="{{ reservation.email }}"
                                    data-phone="{{ reservation.phone_number }}"
                                    data-item="{{ reservation.content_object.name }}"
                                    data-quantity="{{ reservation.quantity }}"
                                    data-date="{{ reservation.reserve_date }}"
                                    data-purpose="{{ reservation.purpose }}"
                                    data-status="{{ reservation.status }}">
                                        <img src="{% static 'images/eye-btn.png' %}" alt="" width="35" height="35">
                                    </button>
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="9" class="text-center">No reservations found.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        
        <!-- Bordered table End -->





        <!-- Modal for Viewing Item -->
        <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header" style="border-bottom: 2px solid #593bdb;">
                        <h5 class="modal-title" id="exampleModalCenterTitle" style="font-size: 25px;">View Student Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group row mb-1">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Student ID:</label>
                            <p id="modal-student-id" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        <div class="form-group row mb-1">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Name:</label>
                            <p id="modal-name" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        <div class="form-group row mb-0">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Course:</label>
                            <p id="modal-course" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        <div class="form-group row mb-0">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Year:</label>
                            <p id="modal-year" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        <div class="form-group row mb-0">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Phone:</label>
                            <p id="modal-phone" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        <div class="form-group row mb-0">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Email:</label>
                            <p id="modal-email" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        <div class="form-group row mb-0">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Item:</label>
                            <p id="modal-item" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        <div class="form-group row mb-0">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Quantity:</label>
                            <p id="modal-quantity" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        <div class="form-group row mb-0">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px; white-space: nowrap;">Date Reserved:</label>
                            <p id="modal-date-borrow" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        
                        <div class="form-group row mb-0">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Status:</label>
                            <p id="modal-status" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                        <div class="form-group row mb-0">
                            <label class="col-form-label text-md-left font-weight-bold col-12 col-md-3 col-lg-3 text-dark" style="font-size: 15px">Purpose:</label>
                            <p id="modal-purpose" class="text-dark mt-1" style="font-size: 15px; position:relative; left: 50px; top: 5px;"></p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>










        <div class="footer-wrap pd-20 mb-20 card-box">
            Borrowing System By: <a href="https://github.com/dropways" target="_blank">Run Time Terror</a>
        </div>
    </div>
</div>



<!-- Add this script to hide the alerts after 5 seconds -->
<script>
    window.setTimeout(function () {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function (alert) {
            alert.classList.remove('show');  // Bootstrap class to hide it
            alert.classList.add('hide-alert');  // Custom transition class

            // Set a delay to completely remove the alert after the fade-out
            window.setTimeout(function () {
                alert.style.display = 'none';  // Completely hide the element
            }, 600);  // Matches the transition duration in CSS (0.6s)
        });
    }, 5000);


    // viewing modal
    document.addEventListener('DOMContentLoaded', function () {
        const viewItemButtons = document.querySelectorAll('.view-item-btn');
    
        viewItemButtons.forEach(button => {
            button.addEventListener('click', function () {
                const studentId = button.getAttribute('data-student-id');
                const name = button.getAttribute('data-name');
                const course = button.getAttribute('data-course');
                const year = button.getAttribute('data-year');
                const phone = button.getAttribute('data-phone');
                const email = button.getAttribute('data-email');
                const item = button.getAttribute('data-item');
                const quantity = button.getAttribute('data-quantity');
                const date = button.getAttribute('data-date');
                const purpose = button.getAttribute('data-purpose');
                const status = button.getAttribute('data-status');
    
                document.getElementById('modal-student-id').innerText = studentId;
                document.getElementById('modal-name').innerText = name;
                document.getElementById('modal-course').innerText = course;
                document.getElementById('modal-year').innerText = year;
                document.getElementById('modal-phone').innerText = phone;
                document.getElementById('modal-email').innerText = email;
                document.getElementById('modal-item').innerText = item;
                document.getElementById('modal-quantity').innerText = quantity;
                document.getElementById('modal-date-borrow').innerText = date;
                document.getElementById('modal-purpose').innerText = purpose;
                document.getElementById('modal-status').innerText = status;
            });
        });
    });


    document.addEventListener('DOMContentLoaded', function() {
        // Function to mark all notifications as read when the user opens the dropdown
        document.getElementById('notification-icon').addEventListener('click', function() {
            fetch('/mark-notifications-read/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ 'action': 'mark_read' })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Mark all notifications as read
                    document.querySelectorAll('#notification-list li').forEach(function(li) {
                        li.classList.add('read');
                    });
                    // Optionally update the count of unread notifications
                    document.querySelector('.notification-active').textContent = '0';
                }
            })
            .catch(error => console.error('Error:', error));
        });
    
        // Function to close individual notifications
        document.querySelectorAll('.notification-close').forEach(button => {
            button.addEventListener('click', function() {
                const reservationId = this.getAttribute('data-id');
    
                fetch(`/mark-as-read/${reservationId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({ 'reservation_id': reservationId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.querySelector(`li[data-id="${reservationId}"]`).remove();
                    }
                });
            });
        });
    
        // CSRF token helper function
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });


    document.addEventListener('DOMContentLoaded', function() {
        // Get all delete buttons
        const deleteButtons = document.querySelectorAll('.notification-close');
    
        deleteButtons.forEach(function(button) {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Get the reservation id from the button's data-id attribute
                const reservationId = this.getAttribute('data-id');
    
                // Send an AJAX request to delete the notification and reset is_handled to false
                fetch('/delete-notification/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'  // Ensure CSRF token is set
                    },
                    body: JSON.stringify({ 'reservation_id': reservationId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // If successful, remove the notification item from the list
                        const notificationItem = document.querySelector(`li[data-id="${reservationId}"]`);
                        if (notificationItem) {
                            notificationItem.remove();  // Remove the entire notification
                        }
                    } else {
                        console.error('Error:', data.message || 'Failed to delete notification');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });
    });


            //toaster message
document.addEventListener("DOMContentLoaded", function() {
    // Configure Toastr options
    toastr.options = {
        "closeButton": true,
        "progressBar": true,
        "timeOut": "5000",
        "positionClass": "toast-bottom-right"
    };

    // Loop through the hidden messages and display them
    document.querySelectorAll('#django-messages .message').forEach(function(el) {
        console.log(el);  // Add this for debugging
        var messageType = el.getAttribute('data-type');
        var messageContent = el.getAttribute('data-content');
    

        // Display Toastr notification based on the message type
        if (messageType === 'success') {
            toastr.success(messageContent);
        } else if (messageType === 'error') {
            toastr.error(messageContent);
        } else if (messageType === 'warning') {
            toastr.warning(messageContent);
        } else if (messageType === 'info') {
            toastr.info(messageContent);
        }
    });
});
    


function searchTable() {
    var input, filter, table, tbody, tr, td, i, j, txtValue, regex;
    input = document.getElementById("searchInput");
    filter = input.value.toUpperCase();
    regex = new RegExp(`(${filter})`, 'gi');
    table = document.getElementById("itemTable");
    tbody = table.getElementsByTagName("tbody")[0];  // Work only with tbody
    tr = tbody.getElementsByTagName("tr");  // Get rows only from tbody
    var noMatch = true;

    // If the input is empty, reset table to show all rows and keep the badge and action button intact
    if (!filter) {
        for (i = 0; i < tr.length; i++) {
            if (tr[i].classList.contains("no-record-row")) continue; // Skip the "No record found" row
            tr[i].style.display = ""; // Show all rows
            td = tr[i].getElementsByTagName("td");
            for (j = 0; j < td.length; j++) {
                // Ensure buttons, dropdowns, badges, and action columns are not affected
                if (j === 7 || j === 8 || j === 9 || td[j].querySelector('.dropdownnn') || td[j].querySelector('.badge') || td[j].querySelector('.action-buttons')) {
                    continue; // Skip "Status", "Action", and dropdowns, badges
                }
                td[j].innerHTML = td[j].textContent || td[j].innerText; // Reset text content
            }
        }
        removeNoRecordRow();  // Remove "No record found" if it exists
        return; // Exit function if input is empty
    }

    // If there's input, filter the table rows
    noMatch = true;  // Reset noMatch for the filtering
    for (i = 0; i < tr.length; i++) {
        if (tr[i].classList.contains("no-record-row")) continue; // Skip "No record found" row

        tr[i].style.display = "none"; // Hide all rows initially
        td = tr[i].getElementsByTagName("td");
        let rowContainsFilter = false;

        // Iterate through each cell in the row
        for (j = 0; j < td.length; j++) {
            if (j === 7 || j === 8 || j === 9) continue; // Skip "Status" and "Action" columns
            if (td[j]) {
                txtValue = td[j].textContent || td[j].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    rowContainsFilter = true;
                    // Highlight matched text only in non-dropdown cells
                    if (!td[j].querySelector('.dropdown')) {
                        td[j].innerHTML = txtValue.replace(regex, "<span style='background-color: rgb(0, 255, 13);'>$1</span>");
                    }
                } else {
                    // Remove highlights if no match
                    if (!td[j].querySelector('.dropdown')) {
                        td[j].innerHTML = txtValue.replace(/<span style='background-color: rgb\(0, 255, 13\);'>(.*?)<\/span>/g, "$1");
                    }
                }
            }
        }

        // If the row contains the filter, show it
        if (rowContainsFilter) {
            tr[i].style.display = "";
            noMatch = false;
        }
    }

    // Show or hide "No record found" message based on matches
    if (noMatch) {
        showNoRecordRow();
    } else {
        removeNoRecordRow(); // Remove the "No record found" row if there are matches
    }

    // Remove existing "no record found" row if present
    var noRecordRow = document.getElementById("noRecordRow");
    if (noRecordRow) {
        noRecordRow.remove();
    }

    // If no matches found, add a "no record found" row
    if (noMatch) {
        var newRow = tbody.insertRow();
        newRow.setAttribute("id", "noRecordRow");
        var cell = newRow.insertCell(0);
        cell.colSpan = table.getElementsByTagName("th").length;
        cell.style.textAlign = "center";
        cell.textContent = "No borrow requests found.";
    }
}

function showNoRecordRow() {
    var noRecordRow = document.querySelector(".no-record-row");
    if (noRecordRow) {
        noRecordRow.style.display = "";
    }
}

function removeNoRecordRow() {
    var noRecordRow = document.querySelector(".no-record-row");
    if (noRecordRow) {
        noRecordRow.style.display = "none";
    }
}
    
</script>





{% endblock content %}